# PVE ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Proxmox VE æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œç™»å½•ã€è™šæ‹Ÿæœºç®¡ç†ã€åˆ°æœŸæ—¶é—´æ§åˆ¶ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·åŠŸèƒ½
- âœ… ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- âœ… JWT èº«ä»½è®¤è¯
- âœ… æŸ¥çœ‹åä¸‹è™šæ‹Ÿæœº/å®¹å™¨åˆ—è¡¨
- âœ… è™šæ‹ŸæœºåŸºæœ¬æ“ä½œï¼šå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€å…³æœº
- âœ… æŸ¥çœ‹è™šæ‹Ÿæœºè¯¦ç»†ä¿¡æ¯ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œé…ç½®ï¼‰
- âœ… NAT ç«¯å£è½¬å‘æ˜¾ç¤º
- âœ… åˆ°æœŸæ—¶é—´ç®¡ç†ï¼ˆåˆ°æœŸåä¸å¯æ“ä½œï¼‰
- âœ… ä¿®æ”¹ä¸ªäººèµ„æ–™å’Œå¯†ç 
- ğŸš§ Webshell/VNC è®¿é—®ï¼ˆå¾…å¼€å‘ï¼‰
- ğŸš§ è™šæ‹Ÿæœºå¯†ç é‡ç½®ï¼ˆå¾…å¼€å‘ï¼‰
- ğŸš§ è™šæ‹Ÿæœºé‡è£…ç³»ç»Ÿï¼ˆå¾…å¼€å‘ï¼‰

### ç®¡ç†å‘˜åŠŸèƒ½
- âœ… PVE æœåŠ¡å™¨ç®¡ç†ï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤æœåŠ¡å™¨è¿æ¥ï¼‰
- âœ… ç”¨æˆ·ç®¡ç†ï¼ˆæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ã€ç¼–è¾‘ç”¨æˆ·ï¼‰
- âœ… è™šæ‹Ÿæœºå…¨é‡ç®¡ç†
  - æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿæœº
  - ä¿®æ”¹è™šæ‹Ÿæœºå½’å±
  - è®¾ç½®åˆ°æœŸæ—¥æœŸ
  - è®¾ç½®è™šæ‹Ÿæœºé…ç½®ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰
- ğŸš§ åˆ›å»ºæ–°è™šæ‹Ÿæœºï¼ˆå¾…å¼€å‘ï¼‰
- ğŸš§ è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®ï¼ˆå¾…å¼€å‘ï¼‰
- ğŸš§ ç»Ÿè®¡æ•°æ®é¢æ¿ï¼ˆå¾…å¼€å‘ï¼‰

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 16 (App Router)
- **UI åº“**: shadcn/ui + Radix UI
- **æ ·å¼**: Tailwind CSS 4
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: PostgreSQL
- **ORM**: Drizzle ORM
- **è®¤è¯**: JWT + bcrypt
- **HTTP å®¢æˆ·ç«¯**: Fetch API

## æ•°æ®åº“è¡¨ç»“æ„

### users (ç”¨æˆ·è¡¨)
- id: ä¸»é”®
- username: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- email: é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
- password: å¯†ç ï¼ˆåŠ å¯†ï¼‰
- role: è§’è‰² (user/admin)
- created_at/updated_at: æ—¶é—´æˆ³

### pve_servers (PVE æœåŠ¡å™¨é…ç½®è¡¨)
- id: ä¸»é”®
- name: æœåŠ¡å™¨åç§°
- host: ä¸»æœºåœ°å€
- port: ç«¯å£ï¼ˆé»˜è®¤ 8006ï¼‰
- username: PVE ç”¨æˆ·å
- api_token: API Token
- realm: è®¤è¯åŸŸï¼ˆé»˜è®¤ pamï¼‰
- is_active: æ˜¯å¦æ¿€æ´»
- created_at/updated_at: æ—¶é—´æˆ³

### virtual_machines (è™šæ‹Ÿæœºè¡¨)
- id: ä¸»é”®
- vm_id: PVE VM ID
- server_id: æœåŠ¡å™¨ IDï¼ˆå¤–é”®ï¼‰
- type: ç±»å‹ (vm/ct)
- name: è™šæ‹Ÿæœºåç§°
- user_id: æ‰€å±ç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- status: çŠ¶æ€ (running/stopped/paused)
- cpu_cores: CPU æ ¸å¿ƒæ•°
- memory: å†…å­˜ï¼ˆMBï¼‰
- disk_size: ç£ç›˜å¤§å°ï¼ˆGBï¼‰
- template: ç³»ç»Ÿæ¨¡æ¿
- root_password: Root å¯†ç 
- ip_address: IP åœ°å€
- gateway: ç½‘å…³
- dns_server: DNS æœåŠ¡å™¨
- nat_enabled: æ˜¯å¦å¯ç”¨ NAT
- nat_port_forward: NAT ç«¯å£è½¬å‘é…ç½®ï¼ˆJSONBï¼‰
- expires_at: åˆ°æœŸæ—¶é—´
- auto_shutdown_on_expiry: åˆ°æœŸæ˜¯å¦è‡ªåŠ¨å…³æœº
- node: PVE èŠ‚ç‚¹åç§°
- created_at/updated_at: æ—¶é—´æˆ³

### vm_operations (è™šæ‹Ÿæœºæ“ä½œæ—¥å¿—è¡¨)
- id: ä¸»é”®
- vm_id: è™šæ‹Ÿæœº IDï¼ˆå¤–é”®ï¼‰
- operation: æ“ä½œç±»å‹
- status: æ“ä½œçŠ¶æ€ (pending/success/failed)
- message: æ“ä½œæ¶ˆæ¯
- user_id: æ“ä½œç”¨æˆ· IDï¼ˆå¤–é”®ï¼‰
- created_at: åˆ›å»ºæ—¶é—´

### system_settings (ç³»ç»Ÿè®¾ç½®è¡¨)
- id: ä¸»é”®
- key: è®¾ç½®é”®ï¼ˆå”¯ä¸€ï¼‰
- value: è®¾ç½®å€¼
- description: æè¿°
- updated_at: æ›´æ–°æ—¶é—´

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 20+
- PostgreSQL 12+
- pnpm 9+

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.local` æ–‡ä»¶å¹¶ä¿®æ”¹é…ç½®ï¼š

```env
# Database
DATABASE_URL=postgresql://username:password@localhost:5432/pve-manager

# JWT Secret (ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹!)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# App
NEXT_PUBLIC_APP_URL=http://localhost:5000
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
pnpm run db:init
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npx next dev --port 5000
```

è®¿é—® http://localhost:5000

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npx next build
pnpm run start
```

## API è·¯ç”±

### è®¤è¯ç›¸å…³
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### ç”¨æˆ·ç›¸å…³
- `GET /api/user/profile` - è·å–ç”¨æˆ·èµ„æ–™
- `PUT /api/user/profile` - æ›´æ–°ç”¨æˆ·èµ„æ–™/å¯†ç 

### è™šæ‹Ÿæœºç›¸å…³
- `GET /api/vms` - è·å–å½“å‰ç”¨æˆ·çš„è™šæ‹Ÿæœºåˆ—è¡¨
- `GET /api/vms/[id]` - è·å–è™šæ‹Ÿæœºè¯¦æƒ…
- `POST /api/vms/[id]/operations` - æ‰§è¡Œè™šæ‹Ÿæœºæ“ä½œï¼ˆå¯åŠ¨/åœæ­¢/é‡å¯/å…³æœºï¼‰

### ç®¡ç†å‘˜ç›¸å…³
- `GET /api/admin/servers` - è·å– PVE æœåŠ¡å™¨åˆ—è¡¨
- `POST /api/admin/servers` - æ·»åŠ  PVE æœåŠ¡å™¨
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/admin/vms` - è·å–æ‰€æœ‰è™šæ‹Ÿæœºåˆ—è¡¨

## é¡¹ç›®ç»“æ„

```
pve-manager/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ dashboard/         # ç”¨æˆ·ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ admin/             # ç®¡ç†å‘˜åå°
â”‚   â”‚   â”œâ”€â”€ settings/          # ä¸ªäººè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ login/             # ç™»å½•é¡µ
â”‚   â”‚   â””â”€â”€ register/          # æ³¨å†Œé¡µ
â”‚   â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui ç»„ä»¶
â”‚   â”‚   â””â”€â”€ dashboard-nav.tsx # ä»ªè¡¨ç›˜å¯¼èˆª
â”‚   â”œâ”€â”€ db/                   # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ schema.ts         # æ•°æ®åº“è¡¨å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts          # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ lib/                  # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ auth.ts           # è®¤è¯ç›¸å…³
â”‚       â””â”€â”€ pve-client.ts     # PVE API å®¢æˆ·ç«¯
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-db.ts           # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ drizzle.config.ts        # Drizzle ORM é…ç½®
â”œâ”€â”€ .env.local               # ç¯å¢ƒå˜é‡
â””â”€â”€ package.json             # é¡¹ç›®ä¾èµ–
```

## å¾…å¼€å‘åŠŸèƒ½

- [ ] Webshell/VNC é›†æˆ
- [ ] è™šæ‹Ÿæœºå¯†ç é‡ç½®åŠŸèƒ½
- [ ] è™šæ‹Ÿæœºé‡è£…ç³»ç»ŸåŠŸèƒ½
- [ ] ç®¡ç†å‘˜åˆ›å»ºæ–°è™šæ‹Ÿæœº
- [ ] è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®ï¼ˆå¢å‡ç¡¬ç›˜ã€ç½‘å¡ç­‰ï¼‰
- [ ] ç»Ÿè®¡æ•°æ®å’Œç›‘æ§é¢æ¿
- [ ] è™šæ‹Ÿæœºæ“ä½œæ—¥å¿—æŸ¥çœ‹
- [ ] ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½
- [ ] äºŒæ­¥éªŒè¯ï¼ˆ2FAï¼‰
- [ ] API å¯†é’¥ç®¡ç†

## å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ JWT_SECRET**
2. ä½¿ç”¨ HTTPS éƒ¨ç½²
3. å®šæœŸæ›´æ–°ä¾èµ–åŒ…
4. é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™
5. å¯ç”¨ CORS ç­–ç•¥
6. æ·»åŠ è¯·æ±‚é€Ÿç‡é™åˆ¶
7. å®šæœŸå¤‡ä»½æ•°æ®åº“

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
